<!DOCTYPE html>
<html lang="en" class="antialiased bg-slate-50 text-slate-800">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zuno • Ops Center</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(99, 102, 241, 0.3)'
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <style>
        [x-cloak] { display: none !important; }

        /* DESKTOP: Lock Viewport. MOBILE: Allow Scroll */
        body { display: flex; flex-direction: column; min-height: 100vh; }
        @media (min-width: 1024px) {
            body { height: 100vh; overflow: hidden; }
        }

        .glass-panel {
            background: white;
            border-radius: 16px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: var(--tw-shadow-soft);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
        }

        /* Alert State for Panels */
        .glass-panel.danger {
            border-color: #fca5a5;
            background-color: #fef2f2;
        }
        .glass-panel.warning {
            border-color: #fdba74;
            background-color: #fff7ed;
        }

        .main-layout {
            flex: 1;
            display: grid;
            gap: 1.5rem;
            padding: 1.5rem;
            min-height: 0;
            /* Responsive Grid Logic */
            grid-template-columns: 1fr;
            grid-template-rows: auto;
        }

        /* Desktop Grid Override */
        @media (min-width: 1024px) {
            .main-layout {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: auto 1fr;
            }
        }

        /* Skeleton Loader */
        .skeleton {
            background-color: #e2e8f0;
            border-radius: 4px;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>

<body x-data="app()" x-init="init()">

    <nav class="px-6 py-4 bg-white/80 backdrop-blur-md border-b border-slate-200 flex justify-between items-center shrink-0 z-20">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-xl bg-indigo-600 flex items-center justify-center text-white shadow-glow">
                <i class="ph-bold ph-asterisk-simple text-xl"></i>
            </div>
            <div>
                <h1 class="font-bold text-slate-800 tracking-tight leading-none">Zuno Monitor</h1>
                <div class="flex items-center gap-2 mt-1">
                    <span class="relative flex h-2 w-2">
                        <span class="absolute inline-flex h-full w-full rounded-full opacity-75" :class="connected ? 'animate-ping bg-emerald-400' : 'bg-rose-400'"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2" :class="connected ? 'bg-emerald-500' : 'bg-rose-500'"></span>
                    </span>
                    <span class="text-xs font-medium text-slate-500" x-text="connected ? 'System Live' : 'Offline'"></span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-3">
             <div class="hidden md:flex items-center gap-2 px-3 py-1.5 bg-slate-100 rounded-full text-xs font-medium text-slate-600">
                <i class="ph-fill ph-globe"></i>
                <span x-text="data?.system?.hostname || 'Scanning...'"></span>
            </div>
            <button @click="fetchData()" class="w-9 h-9 flex items-center justify-center rounded-full bg-white border border-slate-200 text-slate-600 hover:text-indigo-600 transition-colors shadow-sm">
                <i class="ph-bold ph-arrows-clockwise" :class="{'animate-spin': loading}"></i>
            </button>
        </div>
    </nav>

    <div x-show="error" x-transition class="absolute top-24 right-6 z-50 bg-rose-600 text-white px-4 py-3 rounded-xl shadow-xl flex items-center gap-3" x-cloak>
        <i class="ph-fill ph-warning-circle text-xl"></i>
        <div class="text-sm font-bold">Connection Failed</div>
    </div>

    <main class="main-layout" x-show="data" x-transition.opacity>

        <div class="glass-panel p-5 justify-between group">
            <template x-if="!data">
                <div class="space-y-4">
                    <div class="skeleton h-4 w-1/3"></div>
                    <div class="skeleton h-8 w-2/3"></div>
                </div>
            </template>
            <template x-if="data">
                <div class="h-full flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">Uptime</div>
                            <div class="text-2xl xl:text-3xl font-bold text-slate-900 tracking-tight" x-text="formatUptime(data?.system?.uptime_seconds)"></div>
                        </div>
                        <div class="p-2 bg-indigo-50 text-indigo-600 rounded-lg group-hover:scale-110 transition-transform"><i class="ph-fill ph-clock text-xl"></i></div>
                    </div>
                    <div class="flex items-center gap-2 mt-2">
                        <span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-[10px] font-bold uppercase">Stable</span>
                        <span class="text-xs text-slate-400 font-mono" x-text="data?.service?.version"></span>
                    </div>
                </div>
            </template>
        </div>

        <div class="glass-panel p-5 justify-between group"
             :class="{'danger': data?.observability?.response_time_ms > 300, 'warning': data?.observability?.response_time_ms > 150}">
             <div class="flex justify-between items-start">
                <div>
                    <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">Latency</div>
                    <div class="flex items-baseline gap-1">
                        <div class="text-2xl xl:text-3xl font-bold text-slate-900 tracking-tight"
                             :class="{'text-rose-600': data?.observability?.response_time_ms > 300}"
                             x-text="Math.round(data?.observability?.response_time_ms)"></div>
                        <span class="text-sm font-medium text-slate-400">ms</span>
                    </div>
                </div>
                <div class="p-2 bg-rose-50 text-rose-600 rounded-lg group-hover:scale-110 transition-transform"><i class="ph-fill ph-lightning text-xl"></i></div>
            </div>
            <div class="flex items-end gap-1 h-6 mt-2 opacity-60">
                 <template x-for="i in 8">
                    <div class="w-full bg-rose-400 rounded-sm" :style="`height: ${Math.random() * 80 + 20}%`"></div>
                </template>
            </div>
        </div>

        <div class="glass-panel p-5 flex-row items-center justify-between"
             :class="{'danger': data?.resources?.disk?.usage_percent > 90}">
            <div>
                <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">Disk</div>
                <div class="text-2xl xl:text-3xl font-bold text-slate-900 tracking-tight" x-text="data?.resources?.disk?.usage_percent + '%'"></div>
                <div class="text-xs text-slate-400 mt-1 font-mono">
                    <span x-text="Math.round(data?.resources?.disk?.used_gb)"></span>/<span x-text="Math.round(data?.resources?.disk?.total_gb)"></span> GB
                </div>
            </div>
            <div class="relative w-16 h-16 shrink-0">
                <svg class="w-full h-full" viewBox="0 0 36 36">
                    <path class="text-slate-100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" />
                    <path :class="data?.resources?.disk?.usage_percent > 90 ? 'text-rose-500' : 'text-indigo-600'"
                          class="transition-colors duration-500"
                          :stroke-dasharray="`${data?.resources?.disk?.usage_percent}, 100`" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" />
                </svg>
                <i class="ph-fill ph-hard-drives absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xl"
                   :class="data?.resources?.disk?.usage_percent > 90 ? 'text-rose-500' : 'text-indigo-600'"></i>
            </div>
        </div>

        <div class="glass-panel p-0 overflow-y-auto hidden lg:flex">
            <div class="bg-slate-50/80 px-4 py-2 border-b border-slate-100 sticky top-0 backdrop-blur-sm">
                <h3 class="font-bold text-slate-600 text-[10px] uppercase tracking-wide">Host Context</h3>
            </div>
            <div class="divide-y divide-slate-50 text-xs">
                <div class="flex justify-between px-4 py-2.5">
                    <span class="text-slate-500">OS</span>
                    <span class="font-medium text-slate-700" x-text="data?.system?.os"></span>
                </div>
                <div class="flex justify-between px-4 py-2.5">
                    <span class="text-slate-500">Arch</span>
                    <span class="font-mono text-slate-600" x-text="data?.system?.architecture"></span>
                </div>
                <div class="flex justify-between px-4 py-2.5">
                    <span class="text-slate-500">Python</span>
                    <span class="font-mono text-slate-600" x-text="data?.system?.python_version"></span>
                </div>
                <div class="flex justify-between px-4 py-2.5">
                    <span class="text-slate-500">DB</span>
                    <div class="flex items-center gap-1.5">
                        <div class="w-1.5 h-1.5 rounded-full" :class="data?.dependencies?.database?.status === 'healthy' ? 'bg-emerald-500' : 'bg-red-500'"></div>
                        <span class="font-mono text-slate-600" x-text="data?.config?.database_engine.split('.').pop()"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-panel lg:col-span-3 min-h-[350px] lg:min-h-0 bg-white">
            <div class="flex flex-col lg:flex-row h-full divide-y lg:divide-y-0 lg:divide-x divide-slate-100">

                <div class="flex-1 flex flex-col min-h-0">
                    <div class="px-5 py-3 border-b border-slate-100 flex justify-between items-center shrink-0"
                         :class="{'bg-red-50': data?.resources?.cpu_percent > 85}">
                        <h2 class="font-bold text-slate-700 text-sm flex items-center gap-2">
                            <i class="ph-fill ph-cpu text-indigo-500"></i> CPU Load
                        </h2>
                        <div class="flex items-center gap-2">
                             <span x-show="data?.resources?.cpu_percent > 85" class="text-[10px] font-bold text-red-500 animate-pulse">HIGH LOAD</span>
                             <span class="text-xl font-bold"
                                   :class="data?.resources?.cpu_percent > 85 ? 'text-red-600' : 'text-indigo-600'"
                                   x-text="data?.resources?.cpu_percent + '%'"></span>
                        </div>
                    </div>
                    <div class="flex-1 w-full relative min-h-[150px] lg:min-h-0">
                        <div id="cpu-chart" class="absolute inset-0"></div>
                    </div>
                </div>

                <div class="flex-1 flex flex-col min-h-0">
                    <div class="px-5 py-3 border-b border-slate-100 flex justify-between items-center shrink-0">
                        <h2 class="font-bold text-slate-700 text-sm flex items-center gap-2">
                            <i class="ph-fill ph-memory text-emerald-500"></i> Memory Usage
                        </h2>
                        <span class="text-xl font-bold text-emerald-600" x-text="data?.resources?.memory?.usage_percent + '%'"></span>
                    </div>
                    <div class="flex-1 w-full relative min-h-[150px] lg:min-h-0">
                        <div id="ram-chart" class="absolute inset-0"></div>
                    </div>
                </div>

            </div>
        </div>

        <div class="glass-panel flex flex-col justify-between">
            <div class="flex-1 overflow-y-auto p-4">
                <h3 class="font-bold text-slate-400 text-[10px] uppercase tracking-wide mb-3">Feature Flags</h3>
                <div class="space-y-2">
                    <template x-for="(val, key) in data?.features">
                        <div class="flex items-center justify-between p-2 rounded-lg bg-slate-50 border border-slate-100">
                            <span class="text-xs font-semibold text-slate-600 capitalize" x-text="key.replace('_', ' ')"></span>
                            <div class="w-7 h-4 rounded-full relative transition-colors duration-300"
                                 :class="val ? 'bg-indigo-500' : 'bg-slate-300'">
                                <div class="w-3 h-3 bg-white rounded-full absolute top-0.5 shadow-sm transition-all duration-300"
                                     :class="val ? 'left-3.5' : 'left-0.5'"></div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div class="p-4 border-t border-slate-100 bg-slate-50/50">
                <div class="flex items-center gap-3">
                    <div class="p-1.5 rounded-lg" :class="data?.security?.debug_mode ? 'bg-amber-100 text-amber-600' : 'bg-emerald-100 text-emerald-600'">
                        <i class="ph-fill text-lg" :class="data?.security?.debug_mode ? 'ph-warning' : 'ph-shield-check'"></i>
                    </div>
                    <div>
                        <div class="text-[10px] font-bold uppercase text-slate-400">Security Audit</div>
                        <div class="text-xs font-bold whitespace-nowrap" :class="data?.security?.debug_mode ? 'text-amber-600' : 'text-emerald-600'"
                             x-text="data?.security?.debug_mode ? 'Debug Enabled' : 'Production Secure'"></div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        function app() {
            return {
                data: null,
                loading: false,
                connected: false,
                error: false,
                cpuChart: null,
                ramChart: null,
                chartSeries: { cpu: [], mem: [] },

                init() {
                    this.initCharts();
                    this.fetchData();
                    setInterval(() => this.fetchData(true), 2000);
                },

                async fetchData(silent = false) {
                    if (!silent) this.loading = true;
                    try {
                        const res = await fetch("http://localhost:8000/api/v1/health");
                        if (!res.ok) throw new Error();
                        this.data = await res.json();
                        this.connected = true;
                        this.error = false;

                        // Dynamic Title Alert
                        if(this.data.resources.cpu_percent > 90) document.title = "⚠️ High CPU • Zuno";
                        else document.title = "Zuno • Ops Center";

                        this.updateCharts(this.data);
                    } catch (e) {
                        this.connected = false;
                        this.error = true;
                    } finally {
                        this.loading = false;
                    }
                },

                formatUptime(s) {
                    if (!s) return "0h 0m";
                    const h = Math.floor(s / 3600);
                    const m = Math.floor((s % 3600) / 60);
                    return `${h}h ${m}m`;
                },

                initCharts() {
                    const commonOptions = {
                        chart: { type: 'area', height: '100%', width: '100%', toolbar: {show:false}, animations: {enabled: true, easing: 'linear', dynamicAnimation: {speed: 1000}} },
                        stroke: { curve: 'smooth', width: 2 },
                        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.05, stops: [0, 90, 100] } },
                        dataLabels: { enabled: false },
                        xaxis: { labels: {show:false}, tooltip: {enabled:false}, axisBorder: {show:false}, axisTicks: {show:false} },
                        yaxis: { show: true, max: 100, min: 0, tickAmount: 4, labels: { style: { colors: '#94a3b8', fontSize: '11px', fontFamily: 'Inter' } } },
                        grid: { borderColor: '#f1f5f9', strokeDashArray: 4, padding: { top: 0, right: 10, bottom: 0, left: 10 } },
                        legend: { show: false },
                        tooltip: { theme: 'light', x: {show: false} }
                    };

                    this.cpuChart = new ApexCharts(document.querySelector("#cpu-chart"), {
                        ...commonOptions, series: [{name:'CPU', data:[]}], colors: ['#6366f1']
                    });
                    this.cpuChart.render();

                    this.ramChart = new ApexCharts(document.querySelector("#ram-chart"), {
                        ...commonOptions, series: [{name:'RAM', data:[]}], colors: ['#10b981']
                    });
                    this.ramChart.render();
                },

                updateCharts(d) {
                    if (this.chartSeries.cpu.length > 20) {
                        this.chartSeries.cpu.shift();
                        this.chartSeries.mem.shift();
                    }
                    this.chartSeries.cpu.push(d.resources.cpu_percent);
                    this.chartSeries.mem.push(d.resources.memory.usage_percent);

                    this.cpuChart.updateSeries([{ data: this.chartSeries.cpu }]);
                    this.ramChart.updateSeries([{ data: this.chartSeries.mem }]);

                    // Chart Alert Color Logic
                    const cpuColor = d.resources.cpu_percent > 85 ? '#ef4444' : '#6366f1';
                    this.cpuChart.updateOptions({ colors: [cpuColor] });
                }
            }
        }
    </script>
</body>
</html>